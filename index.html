<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MIDI Scale Finder — detect the key of a MIDI file</title>
    <script src="Midi.js"></script>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <main class="page">
        <h1>Find the key/scale of a MIDI file (Major/Minor)</h1>
        <p class="muted">Upload a .mid/.midi file — or start choosing notes — to find a key/scale (Major/Minor).</p>

        <div id="dropzone" class="panel" role="button" tabindex="0" aria-label="Drop MIDI file here or click to select file">
            <div id="dropzoneContent">
                <div>Drop MIDI file here or click to choose</div>
                <div id="fileName" class="file-name hidden"></div>
            </div>
            <input type="file" id="fileInput" accept=".mid,.midi" style="display: none;" aria-label="Choose MIDI file">
        </div>
        <div id="output" aria-live="polite" role="region" aria-label="Analysis results">
            <div class="app-layout">
                <section class="app-left" aria-label="Note selection">
                    <h2 class="app-title" id="scaleTitle">Auto Scale</h2>
                    <div id="pianoMount" class="piano-mount" aria-label="Piano note selector"></div>
                    <div class="app-controls">
                        <button id="clearBtn" type="button" disabled>Clear</button>
                        <button id="resetToMidiBtn" type="button" disabled>Reset to MIDI</button>
                        <button id="undoBtn" type="button" disabled>Undo</button>
                        <button id="redoBtn" type="button" disabled>Redo</button>
                    </div>
                    <div class="keyboard-controls" aria-label="Keyboard piano mode">
                        <label class="kb-toggle">
                            <input id="keyboardModeToggle" type="checkbox" />
                            <span>Keyboard mode</span>
                        </label>
                        <label class="kb-select">
                            <span class="kb-select-label">Input</span>
                            <select id="keyboardInputMode" disabled aria-label="Keyboard input mode">
                                <option value="record" selected>Record (accumulate)</option>
                                <option value="live">Live (held)</option>
                            </select>
                        </label>
                    </div>
                    <div class="app-subtext" id="selectionHint">Select notes to see possible scales.</div>
                </section>
                <section class="app-right" aria-label="Scale results">
                    <div id="scaleOutput"></div>
                </section>
            </div>
        </div>

        <section class="panel" aria-labelledby="about-heading">
            <h2 id="about-heading">What this does</h2>
            <p>Analyzes MIDI files to determine their key/scale. For now, it only supports Major and Minor scales.</p>
            <h2>Key vs scale</h2>
            <p>A <strong>scale</strong> is a set of notes (like A natural minor). A <strong>key</strong> usually means a scale <em>plus</em> a “home” note (the tonic) and a musical context. This tool lists Major/Minor <strong>keys</strong> (tonic + mode) that best fit your selected notes.</p>
            <h2>How results are shown</h2>
            <p>First you’ll see possible Major/Minor scales for the detected notes, ranked with the best guess highlighted. Open the “Why the best guess?” dropdown to see a simple explanation. Below that, you’ll see which notes were found in the MIDI and roughly how much of the song each note takes up.</p>
            <p><strong>What does “emphasis” mean?</strong> In this app, “emphasis” means which notes are used the most (based on MIDI note durations, or your current selection). If multiple keys are an identical match (for example several are 100% match because they contain the same notes), the sorting uses a tie-break that favors keys where the <em>tonic</em> (home note), the <em>3rd</em>, and the <em>5th</em> are more emphasized. This is a heuristic to pick the most likely key from many equally-valid candidates.</p>
            <h2>What does "tonic" mean?</h2>
            <p>The tonic is the "home" note—the pitch everything feels drawn back to. Knowing the tonic tells you the song's key, so you know which chords and melodies fit naturally.</p>
        </section>
    </main>

    <footer class="footer" role="contentinfo">
        Open source - contributions welcome on <a href="https://github.com/hakonno/midi-scale-finder" target="_blank" rel="noopener noreferrer">GitHub</a>.
    </footer>

    <script type="module" src="./script.js"></script>
</body>
</html>